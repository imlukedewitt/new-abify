<div class="grid h-[calc(100dvh-var(--header-height))] grid-cols-[300px_1fr]">
  <!-- Left Sidebar: Workflow Info + Step List -->
  <div class="bg-base-300 p-4 overflow-auto">
    <%= link_to "â† Workflows", workflows_path, class: "link-primary text-sm" %>
    <h1 class="mt-2"><%= @workflow.name %></h1>
    <div class="text-sm opacity-70 mt-1">
      <% if @workflow.handle.present? %>
        <span class="badge badge-ghost badge-sm"><%= @workflow.handle %></span>
      <% end %>
    </div>
    <div class="mt-4 space-y-2 text-sm">
      <div>
        <span class="opacity-70">Connection:</span>
        <span><%= @workflow.connection&.name || "None" %></span>
      </div>
    </div>
    <div class="flex gap-2 mt-4">
      <%= link_to "Edit Workflow", edit_workflow_path(@workflow), class: "btn btn-ghost btn-xs" %>
      <%= link_to "Run History", workflow_executions_path, class: "btn btn-ghost btn-xs" %>
    </div>
    <div class="divider"></div>

    <!-- Steps List -->
    <div class="flex justify-between items-center mb-2">
      <h2 class="text-lg font-semibold">Steps (<%= @workflow.steps.size %>)</h2>
      <%= link_to new_workflow_step_path(@workflow), class: "btn btn-primary btn-xs" do %>
        + Add Step
      <% end %>
    </div>
    <% if @workflow.steps.any? %>
      <ul class="space-y-2">
        <% @workflow.steps.each_with_index do |step, index| %>
          <%= render "steps/step_list_item", step: step, workflow: @workflow, index: index %>
        <% end %>
      </ul>
    <% else %>
      <p class="text-sm opacity-70">No steps yet. Add your first step to get started.</p>
    <% end %>
  </div>

  <!-- Right Panel: Step Detail (shown when viewing a step) -->
  <div class="bg-base-100 p-6 overflow-auto">
    <% if @step %>
      <%= render "steps/detail", step: @step, workflow: @workflow, connections: @connections %>
    <% else %>
      <div class="flex flex-col items-center justify-center h-full opacity-50">
        <p class="text-lg">Select a step to view details</p>
        <p class="text-sm">or <%= link_to "add a new step", new_workflow_step_path(@workflow), class: "link" %></p>
      </div>
    <% end %>
  </div>
</div>
